/*!
 * jsUri v1.1.1
 * https://github.com/derek-watson/jsUri
 *
 * Copyright 2011, Derek Watson
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Includes parseUri regular expressions
 * http://blog.stevenlevithan.com/archives/parseuri
 * Copyright 2007, Steven Levithan
 * Released under the MIT license.
 *
 * Date: Mon Nov 14 20:06:34 2011 -0800
 */var Query=function(queryString){"use strict";var parseQuery=function(q){var arr=[],i,ps,p,keyval;if(typeof q==="undefined"||q===null||q===""){return arr}if(q.indexOf("?")===0){q=q.substring(1)}ps=q.toString().split(/[&;]/);for(i=0;i<ps.length;i++){p=ps[i];keyval=p.split("=");arr.push([keyval[0],keyval[1]])}return arr},params=parseQuery(queryString),toString=function(){var s="",i,param;for(i=0;i<params.length;i++){param=params[i];if(s.length>0){s+="&"}s+=param.join("=")}return s.length>0?"?"+s:s},decode=function(s){s=decodeURIComponent(s);s=s.replace("+"," ");return s},getParamValue=function(key){var param,i;for(i=0;i<params.length;i++){param=params[i];if(decode(key)===decode(param[0])){return param[1]}}},getParamValues=function(key){var arr=[],i,param;for(i=0;i<params.length;i++){param=params[i];if(decode(key)===decode(param[0])){arr.push(param[1])}}return arr},deleteParam=function(key,val){var arr=[],i,param,keyMatchesFilter,valMatchesFilter;for(i=0;i<params.length;i++){param=params[i];keyMatchesFilter=decode(param[0])===decode(key);valMatchesFilter=decode(param[1])===decode(val);if(arguments.length===1&&!keyMatchesFilter||arguments.length===2&&!keyMatchesFilter&&!valMatchesFilter){arr.push(param)}}params=arr;return this},addParam=function(key,val,index){if(arguments.length===3&&index!==-1){index=Math.min(index,params.length);params.splice(index,0,[key,val])}else if(arguments.length>0){params.push([key,val])}return this},replaceParam=function(key,newVal,oldVal){var index=-1,i,param;if(arguments.length===3){for(i=0;i<params.length;i++){param=params[i];if(decode(param[0])===decode(key)&&decodeURIComponent(param[1])===decode(oldVal)){index=i;break}}deleteParam(key,oldVal).addParam(key,newVal,index)}else{for(i=0;i<params.length;i++){param=params[i];if(decode(param[0])===decode(key)){index=i;break}}deleteParam(key);addParam(key,newVal,index)}return this};return{getParamValue:getParamValue,getParamValues:getParamValues,deleteParam:deleteParam,addParam:addParam,replaceParam:replaceParam,toString:toString}};var Uri=function(uriString){"use strict";var strictMode=false,parseUri=function(str){var parsers={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},keys=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q={name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},m=parsers[strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--){uri[keys[i]]=m[i]||""}uri[q.name]={};uri[keys[12]].replace(q.parser,function($0,$1,$2){if($1){uri[q.name][$1]=$2}});return uri},uriParts=parseUri(uriString||""),queryObj=new Query(uriParts.query),protocol=function(val){if(typeof val!=="undefined"){uriParts.protocol=val}return uriParts.protocol},hasAuthorityPrefixUserPref=null,hasAuthorityPrefix=function(val){if(typeof val!=="undefined"){hasAuthorityPrefixUserPref=val}if(hasAuthorityPrefixUserPref===null){return uriParts.source.indexOf("//")!==-1}else{return hasAuthorityPrefixUserPref}},userInfo=function(val){if(typeof val!=="undefined"){uriParts.userInfo=val}return uriParts.userInfo},host=function(val){if(typeof val!=="undefined"){uriParts.host=val}return uriParts.host},port=function(val){if(typeof val!=="undefined"){uriParts.port=val}return uriParts.port},path=function(val){if(typeof val!=="undefined"){uriParts.path=val}return uriParts.path},query=function(val){if(typeof val!=="undefined"){queryObj=new Query(val)}return queryObj},anchor=function(val){if(typeof val!=="undefined"){uriParts.anchor=val}return uriParts.anchor},setProtocol=function(val){protocol(val);return this},setHasAuthorityPrefix=function(val){hasAuthorityPrefix(val);return this},setUserInfo=function(val){userInfo(val);return this},setHost=function(val){host(val);return this},setPort=function(val){port(val);return this},setPath=function(val){path(val);return this},setQuery=function(val){query(val);return this},setAnchor=function(val){anchor(val);return this},getQueryParamValue=function(key){return query().getParamValue(key)},getQueryParamValues=function(key){return query().getParamValues(key)},deleteQueryParam=function(key,val){if(arguments.length===2){query().deleteParam(key,val)}else{query().deleteParam(key)}return this},addQueryParam=function(key,val,index){if(arguments.length===3){query().addParam(key,val,index)}else{query().addParam(key,val)}return this},replaceQueryParam=function(key,newVal,oldVal){if(arguments.length===3){query().replaceParam(key,newVal,oldVal)}else{query().replaceParam(key,newVal)}return this},toString=function(){var s="",is=function(s){return s!==null&&s!==""};if(is(protocol())){s+=protocol();if(protocol().indexOf(":")!==protocol().length-1){s+=":"}s+="//"}else{if(hasAuthorityPrefix()&&is(host())){s+="//"}}if(is(userInfo())&&is(host())){s+=userInfo();if(userInfo().indexOf("@")!==userInfo().length-1){s+="@"}}if(is(host())){s+=host();if(is(port())){s+=":"+port()}}if(is(path())){s+=path()}else{if(is(host())&&(is(query().toString())||is(anchor()))){s+="/"}}if(is(query().toString())){if(query().toString().indexOf("?")!==0){s+="?"}s+=query().toString()}if(is(anchor())){if(anchor().indexOf("#")!==0){s+="#"}s+=anchor()}return s},clone=function(){return new Uri(toString())};return{protocol:protocol,hasAuthorityPrefix:hasAuthorityPrefix,userInfo:userInfo,host:host,port:port,path:path,query:query,anchor:anchor,setProtocol:setProtocol,setHasAuthorityPrefix:setHasAuthorityPrefix,setUserInfo:setUserInfo,setHost:setHost,setPort:setPort,setPath:setPath,setQuery:setQuery,setAnchor:setAnchor,getQueryParamValue:getQueryParamValue,getQueryParamValues:getQueryParamValues,deleteQueryParam:deleteQueryParam,addQueryParam:addQueryParam,replaceQueryParam:replaceQueryParam,toString:toString,clone:clone}};var jsUri=Uri;(function(exports){var INT_REGEXP=/^[0-9]+$/;function SrcsetInfo(options){this.imageCandidates=[];this.srcValue=options.src;this.srcsetValue=options.srcset;this.isValid=true;this.error="";this._parse(this.srcsetValue);if(!this.isValid){console.error("Error: "+this.error)}}SrcsetInfo.prototype._parse=function(){var input=this.srcsetValue,position=0,rawCandidates=[],url,descriptors;while(input!==""){while(input.charAt(0)===" "){input=input.slice(1)}position=input.indexOf(" ");if(position!==-1){url=input.slice(0,position);if(url===""){break}input=input.slice(position+1);position=input.indexOf(",");if(position===-1){descriptors=input;input=""}else{descriptors=input.slice(0,position);input=input.slice(position+1)}rawCandidates.push({url:url,descriptors:descriptors})}else{rawCandidates.push({url:input,descriptors:""});input=""}}for(var i=0,len=rawCandidates.length;i<len;i++){var candidate=rawCandidates[i],desc=this._parseDescriptors(candidate.descriptors);this._addCandidate(new ImageInfo({src:candidate.url,x:desc.x,w:desc.w,h:desc.h}))}if(this.srcValue){this._addCandidate(new ImageInfo({src:this.srcValue}))}};SrcsetInfo.prototype._addCandidate=function(imageInfo){for(var j=0;j<this.imageCandidates.length;j++){var existingCandidate=this.imageCandidates[j];if(existingCandidate.x==imageInfo.x&&existingCandidate.w==imageInfo.w&&existingCandidate.h==imageInfo.h){return}}this.imageCandidates.push(imageInfo)};SrcsetInfo.prototype._parseDescriptors=function(descString){var descriptors=descString.split(/\s/);var out={};for(var i=0;i<descriptors.length;i++){var desc=descriptors[i];if(desc.length>0){var lastChar=desc[desc.length-1];var value=desc.substring(0,desc.length-1);var intVal=parseInt(value,10);var floatVal=parseFloat(value);if(value.match(INT_REGEXP)&&lastChar==="w"){out[lastChar]=intVal}else if(value.match(INT_REGEXP)&&lastChar=="h"){out[lastChar]=intVal}else if(!isNaN(floatVal)&&lastChar=="x"){out[lastChar]=floatVal}else{this.error='Invalid srcset descriptor found in "'+desc+'".';this.isValid=false}}}return out};function ImageInfo(options){this.src=options.src;this.w=options.w||Infinity;this.h=options.h||Infinity;this.x=options.x||1}exports.SrcsetInfo=SrcsetInfo})(window);(function(exports){function ViewportInfo(){this.w=null;this.h=null;this.x=null}ViewportInfo.prototype.compute=function(){this.w=window.innerWidth||document.documentElement.clientWidth;this.h=window.innerHeight||document.documentElement.clientHeight;this.x=window.devicePixelRatio};ViewportInfo.prototype.setForTesting=function(options){this.w=options.w;this.h=options.h;this.x=options.x};ViewportInfo.prototype.getBestImage=function(srcsetInfo){var images=srcsetInfo.imageCandidates.slice(0);var largestWidth=this._getBestCandidateIf(images,function(a,b){return a.w>b.w});this._removeCandidatesIf(images,function(scope){return function(a){return a.w<scope.w}}(this));if(images.length===0){images=[largestWidth]}var largestHeight=this._getBestCandidateIf(images,function(a,b){return a.h>b.h});this._removeCandidatesIf(images,function(scope){return function(a){return a.h<scope.h}}(this));if(images.length===0){images=[largestHeight]}var largestPxDensity=this._getBestCandidateIf(images,function(a,b){return a.x>b.x});this._removeCandidatesIf(images,function(scope){return function(a){return a.x<scope.x}}(this));if(images.length===0){images=[largestPxDensity]}var smallestWidth=this._getBestCandidateIf(images,function(a,b){return a.w<b.w});this._removeCandidatesIf(images,function(a,b){return a.w>smallestWidth.w});var smallestHeight=this._getBestCandidateIf(images,function(a,b){return a.h<b.h});this._removeCandidatesIf(images,function(a,b){return a.h>smallestWidth.h});var smallestPxDensity=this._getBestCandidateIf(images,function(a,b){return a.x<b.x});this._removeCandidatesIf(images,function(a,b){return a.x>smallestPxDensity.x});return images[0]};ViewportInfo.prototype._getBestCandidateIf=function(images,criteriaFn){var bestCandidate=images[0];for(var i=0;i<images.length;i++){var candidate=images[i];if(criteriaFn(candidate,bestCandidate)){bestCandidate=candidate}}return bestCandidate};ViewportInfo.prototype._removeCandidatesIf=function(images,criteriaFn){for(var i=images.length-1;i>=0;i--){var candidate=images[i];if(criteriaFn(candidate)){images.splice(i,1)}}return images};ViewportInfo.prototype.getBestImage2=function(srcsetInfo){var bestMatch=null;var images=srcsetInfo.imageCandidates;for(var i=0;i<images.length;i++){var imageCandidate=images[i];var bestMatchX=bestMatch?bestMatch.x:0;if(bestMatchX<=imageCandidate.x&&imageCandidate.x<=this.x){if(bestMatch===null){bestMatch=imageCandidate;continue}if(this.w<=imageCandidate.w&&imageCandidate.w<=bestMatch.w){bestMatch=imageCandidate}}}return bestMatch};exports.ViewportInfo=ViewportInfo})(window);(function(exports){function isSrcsetImplemented(){var img=new Image;return"srcset"in img}function main(){if(isSrcsetImplemented()){return}var viewportInfo=new ViewportInfo;viewportInfo.compute();var images=document.querySelectorAll("img");for(var i=0;i<images.length;i++){var img=images[i];var srcset=img.getAttribute("srcset");if(srcset){var srcsetInfo=new SrcsetInfo({src:img.src,srcset:srcset});var imageInfo=viewportInfo.getBestImage(srcsetInfo);img.src=imageInfo.src;img.style.webkitTransform="scale("+1/imageInfo.x+")";img.style.webkitTransformOrigin="0 0"}}}var readyTimer=setInterval(function(){if(document.readyState==="complete"){main();clearInterval(readyTimer)}},10)})(window);